module Steep
  module Interface
    class Shape
      class Entry
        attr_reader method_types: Array[MethodType]

        def initialize: (method_types: Array[MethodType]) -> void

        def to_s: () -> String
      end

      class UnionEntry
        attr_reader entries: Array[Entry]

        attr_reader subtyping: Subtyping::Check

        def initialize: (entries: Array[Entry], subtyping: Subtyping::Check) -> void

        def to_s: () -> String

        def resolve: () -> Entry?
      end

      class Methods
        type entry = Entry | UnionEntry

        def []=: (Symbol, entry) -> entry

        def []: (Symbol) -> Entry?

        def fetch: (Symbol) -> Entry

        def key?: (Symbol) -> bool

        def each: () { ([Symbol, Entry]) -> void } -> void
                | () -> Enumerator[[Symbol, Entry], void]

        def each_name: () { (Symbol) -> void } -> void
                     | () -> Enumerator[Symbol, void]

        include Enumerable[[Symbol, Entry]]

        attr_reader substs: Array[Substitution]

        attr_reader methods: Hash[Symbol, entry]
        attr_reader resolved_methods: Hash[Symbol, Entry?]

        def initialize: (substs: Array[Substitution], methods: Hash[Symbol, entry]) -> void

        @subst: Substitution?
        def subst: () -> Substitution

        def push_substitution: (Substitution) -> Methods

        def merge!: (Methods other) -> void
      end

      attr_reader type: AST::Types::t

      attr_reader methods: Methods

      @private: bool

      def initialize: (type: AST::Types::t, private: bool, ?methods: Methods?) -> void

      def update: (?type: AST::Types::t, ?methods: Methods) -> self

      def private?: () -> bool

      def public?: () -> bool

      def subst: (Substitution, ?type: AST::Types::t?) -> Shape
    end
  end
end
